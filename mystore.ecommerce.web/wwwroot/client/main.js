(self.webpackChunkclient=self.webpackChunkclient||[]).push([[179],{255:d=>{function a(c){return Promise.resolve().then(()=>{var l=new Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l})}a.keys=()=>[],a.resolve=a,a.id=255,d.exports=a},87:(d,a,c)=>{"use strict";var l=c(75),t=c(639),m=c(841),p=c(855);let A=(()=>{class r{constructor(){this.title="Shop"}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["the-shop"]],decls:3,vars:0,consts:[[1,"row"],[1,"col-12"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t._UZ(2,"router-outlet"),t.qZA(),t.qZA())},directives:[p.lC],encapsulation:2}),r})();var Z=c(2);class T{}class _{constructor(){this.orderNumber="M"+Math.random().toString(),this.orderDate=new Date,this.totalAmount=0,this.totalDiscount=0,this.orderItems=[]}get subtotal(){return this.orderItems.reduce((e,o)=>e+o.unitPrice*o.quantity,0)}}let g=(()=>{class r{constructor(e){this.http=e,this.products=[],this.order=new _,this.token="",this.expiration=new Date}loadProducts(){return this.http.get("/api/products").pipe((0,Z.U)(e=>{this.products=e}))}get loginRequired(){return 0==this.token.length||this.expiration>new Date}login(e){return this.http.post("/account/createtoken",e).pipe((0,Z.U)(o=>{this.token=o.token,this.expiration=o.expiration}))}addToOrder(e){let o;if(o=this.order.orderItems.find(i=>i.productId===e.id),o)o.quantity++,this.order.totalAmount=this.order.totalAmount+o.unitPrice,o.totalPrice=o.totalPrice+o.unitPrice;else{const i=new T;i.productId=e.id,i.product=e,i.unitPrice=e.price,i.quantity=1,i.totalPrice=e.price,this.order.totalAmount=this.order.totalAmount+i.totalPrice,this.order.orderItems.push(i)}}removeFromCart(e){let o;o=this.order.orderItems.find(i=>i.productId===e.id),o&&(this.order.totalAmount=this.order.totalAmount-(null==o?void 0:o.totalPrice),this.order.orderItems=this.order.orderItems.filter(i=>i!==o))}checkout(){const e=(new m.WM).set("Authorization",`Bearer ${this.token}`);return this.http.post("/api/orders",this.order,{headers:e}).pipe((0,Z.U)(()=>{this.order=new _}))}}return r.\u0275fac=function(e){return new(e||r)(t.LFG(m.eN))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac}),r})();var h=c(583);function v(r,n){if(1&r&&(t.TgZ(0,"div",9),t._uU(1),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Oqu(e.errorMessage)}}function q(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td"),t._UZ(2,"img",10),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.ALo(9,"currency"),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.ALo(12,"currency"),t.qZA(),t.TgZ(13,"td"),t.TgZ(14,"button",11),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw().store.removeFromCart(s.product)}),t._UZ(15,"i",12),t.qZA(),t.qZA(),t.qZA()}if(2&r){const e=n.$implicit;t.xp6(2),t.MGl("src","/img/",e.product.imageName,"",t.LSH),t.xp6(2),t.lnq("",e.product.category,"(",e.product.size,") : ",e.product.productName,""),t.xp6(2),t.Oqu(e.quantity),t.xp6(2),t.Oqu(t.xi3(9,7,e.unitPrice,"LKR ")),t.xp6(3),t.Oqu(t.xi3(12,10,e.unitPrice*e.quantity,"LKR "))}}let x=(()=>{class r{constructor(e,o){this.store=e,this.router=o,this.errorMessage=""}onCheckout(){this.errorMessage="",this.store.checkout().subscribe(()=>{this.router.navigate(["/"])},e=>{this.errorMessage=`Failed to checkout: ${e}`})}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(g),t.Y36(p.F0))},r.\u0275cmp=t.Xpm({type:r,selectors:[["checkout"]],decls:29,vars:10,consts:[[1,"row"],["class","alert alert-danger",4,"ngIf"],[1,"table","table-bordered","table-hover"],[4,"ngFor","ngForOf"],[1,"col-md-4","col-md-offset-8","text-right"],[1,"table","table-condensed"],[1,"text-right"],[1,"btn","btn-success",3,"click"],["routerLink","/",1,"btn","btn-info"],[1,"alert","alert-danger"],["alt","o.product.productName",1,"img-thumbnail","checkout-thumb",3,"src"],[1,"btn","btn-danger","btn-remove",3,"click"],[1,"fas","fa-times"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"h3"),t._uU(2,"Confirm Order"),t.qZA(),t.YNc(3,v,2,1,"div",1),t.TgZ(4,"table",2),t.YNc(5,q,16,13,"tr",3),t.qZA(),t.TgZ(6,"div",4),t.TgZ(7,"table",5),t.TgZ(8,"tr"),t.TgZ(9,"td",6),t._uU(10,"Subtotal"),t.qZA(),t.TgZ(11,"td",6),t._uU(12),t.ALo(13,"currency"),t.qZA(),t.qZA(),t.TgZ(14,"tr"),t.TgZ(15,"td",6),t._uU(16,"Shipping"),t.qZA(),t.TgZ(17,"td",6),t._uU(18,"LKR 0.00"),t.qZA(),t.qZA(),t.TgZ(19,"tr"),t.TgZ(20,"td",6),t._uU(21,"Total:"),t.qZA(),t.TgZ(22,"td",6),t._uU(23),t.ALo(24,"currency"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(25,"button",7),t.NdJ("click",function(){return o.onCheckout()}),t._uU(26,"Complete Purchase"),t.qZA(),t.TgZ(27,"a",8),t._uU(28,"Cancel"),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(3),t.Q6J("ngIf",o.errorMessage),t.xp6(2),t.Q6J("ngForOf",o.store.order.orderItems),t.xp6(7),t.Oqu(t.xi3(13,4,o.store.order.subtotal,"LKR ")),t.xp6(11),t.Oqu(t.xi3(24,7,o.store.order.subtotal,"LKR ")))},directives:[h.O5,h.sg,p.yS],pipes:[h.H9],styles:[".checkout-thumb[_ngcontent-%COMP%]{max-width:100px}"]}),r})();var u=c(665);function b(r,n){if(1&r&&(t.TgZ(0,"div",14),t._uU(1),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Oqu(e.errorMessage)}}function w(r,n){1&r&&(t.TgZ(0,"div",15),t._uU(1,"Required"),t.qZA())}function P(r,n){1&r&&(t.TgZ(0,"div",15),t._uU(1,"Required"),t.qZA())}let y=(()=>{class r{constructor(e,o){this.store=e,this.router=o,this.creds={username:"",password:""},this.errorMessage=""}onLogin(){this.store.login(this.creds).subscribe(()=>{this.router.navigate(this.store.order.orderItems.length>0?["checkout"]:[""])},e=>{console.log(e),this.errorMessage="Failed to login"})}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(g),t.Y36(p.F0))},r.\u0275cmp=t.Xpm({type:r,selectors:[["login-page"]],decls:20,vars:6,consts:[[1,"row"],[1,"col-md-4","col-md-offset-4"],["class","alert alert-danger",4,"ngIf"],[3,"submit"],[1,"form-group"],["for","username"],["type","text","name","name","required","",1,"form-control",3,"ngModel","ngModelChange"],["username","ngModel"],["class","text-danger",4,"ngIf"],["for","password"],["type","password","name","password","required","",1,"form-control",3,"ngModel","ngModelChange"],["password","ngModel"],["type","submit","value","Login",1,"btn","btn-success",3,"disabled"],["href","#",1,"btn","btn-default"],[1,"alert","alert-danger"],[1,"text-danger"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.YNc(2,b,2,1,"div",2),t.TgZ(3,"form",3),t.NdJ("submit",function(){return o.onLogin()}),t.TgZ(4,"div",4),t.TgZ(5,"label",5),t._uU(6,"Username"),t.qZA(),t.TgZ(7,"input",6,7),t.NdJ("ngModelChange",function(s){return o.creds.username=s}),t.qZA(),t.YNc(9,w,2,0,"div",8),t.qZA(),t.TgZ(10,"div",4),t.TgZ(11,"label",9),t._uU(12,"Password"),t.qZA(),t.TgZ(13,"input",10,11),t.NdJ("ngModelChange",function(s){return o.creds.password=s}),t.qZA(),t.YNc(15,P,2,0,"div",8),t.qZA(),t.TgZ(16,"div",4),t._UZ(17,"input",12),t.TgZ(18,"a",13),t._uU(19,"Cancel"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e){const i=t.MAs(8),s=t.MAs(14);t.xp6(2),t.Q6J("ngIf",o.errorMessage),t.xp6(5),t.Q6J("ngModel",o.creds.username),t.xp6(2),t.Q6J("ngIf",i.touched&&i.invalid&&(null==i.errors?null:i.errors.required)),t.xp6(4),t.Q6J("ngModel",o.creds.password),t.xp6(2),t.Q6J("ngIf",s.touched&&s.invalid&&(null==s.errors?null:s.errors.required)),t.xp6(2),t.Q6J("disabled",i.invalid||s.invalid)}},directives:[h.O5,u._Y,u.JL,u.F,u.Fj,u.Q7,u.JJ,u.On],encapsulation:2}),r})();function C(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"div",2),t.TgZ(1,"div",3),t._UZ(2,"img",4),t.TgZ(3,"ul",5),t.TgZ(4,"li"),t._uU(5),t.qZA(),t.TgZ(6,"li"),t.TgZ(7,"h4",6),t._uU(8),t.qZA(),t.qZA(),t.TgZ(9,"li"),t._uU(10),t.qZA(),t.TgZ(11,"li"),t.TgZ(12,"p",7),t.TgZ(13,"strong"),t._uU(14),t.ALo(15,"currency"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(16,"div",8),t.TgZ(17,"button",9),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw().store.addToOrder(s)}),t._uU(18,"Add to cart"),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&r){const e=n.$implicit;t.xp6(2),t.MGl("src","/img/",e.imageName,"",t.LSH),t.s9C("alt",e.productName),t.xp6(3),t.Oqu(e.category),t.xp6(3),t.Oqu(e.productName),t.xp6(2),t.Oqu(e.size),t.xp6(4),t.hij(" ",t.xi3(15,6,e.price,"LKR ")," ")}}let k=(()=>{class r{constructor(e){this.store=e,this.products=[]}ngOnInit(){this.store.loadProducts().subscribe(()=>{})}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(g))},r.\u0275cmp=t.Xpm({type:r,selectors:[["product-list"]],decls:2,vars:1,consts:[[1,"row","text-center"],["class","card mb-4 box-shadow col-md-3",4,"ngFor","ngForOf"],[1,"card","mb-4","box-shadow","col-md-3"],[1,"rounded","p-1","fill-height"],[1,"img-fluid",3,"src","alt"],[1,"list-unstyled","mt-3","mb-4"],[1,"my-0","font-weight-normal"],[1,"p-1"],[1,""],["id","buyButton",1,"btn","btn-success","btn-lg","btn-block","mt-auto",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.YNc(1,C,19,9,"div",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngForOf",o.store.products))},directives:[h.sg],pipes:[h.H9],styles:[".product-image[_ngcontent-%COMP%]{border:1px #ddd solid;box-shadow:#0006 2px 2px;margin:2px}"]}),r})(),U=(()=>{class r{constructor(e){this.store=e}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(g))},r.\u0275cmp=t.Xpm({type:r,selectors:[["cart"]],decls:4,vars:1,consts:[["routerLink","checkout",1,"btn","cart-link"],[1,"fas","fa-shopping-cart"]],template:function(e,o){1&e&&(t.TgZ(0,"div"),t.TgZ(1,"a",0),t._UZ(2,"i",1),t._uU(3),t.qZA(),t.qZA()),2&e&&(t.xp6(3),t.hij(" ",o.store.order.orderItems.length,""))},directives:[p.yS],styles:["product-thumb[_ngcontent-%COMP%]{max-width:150px}"]}),r})(),L=(()=>{class r{constructor(){this.title="Welcome to My Store"}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["shop-page"]],decls:7,vars:1,consts:[[1,"row"],[1,"col-11"],[1,"col-1"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h3"),t._uU(3),t.qZA(),t._UZ(4,"product-list"),t.qZA(),t.TgZ(5,"div",2),t._UZ(6,"cart"),t.qZA(),t.qZA()),2&e&&(t.xp6(3),t.Oqu(o.title))},directives:[k,U],encapsulation:2}),r})(),f=(()=>{class r{constructor(e,o){this.store=e,this.router=o}canActivate(e,o){return!this.store.loginRequired||(this.router.navigate(["login"]),!1)}}return r.\u0275fac=function(e){return new(e||r)(t.LFG(g),t.LFG(p.F0))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac}),r})();const O=p.Bz.forRoot([{path:"",component:L},{path:"checkout",component:x,canActivate:[f]},{path:"login",component:y},{path:"**",redirectTo:"/"}],{useHash:!1});let F=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r,bootstrap:[A]}),r.\u0275inj=t.cJS({providers:[g,f],imports:[[l.b2,m.JF,O,u.u5]]}),r})();(0,t.G48)(),l.q6().bootstrapModule(F).catch(r=>console.error(r))}},d=>{d.O(0,[736],()=>d(d.s=87)),d.O()}]);